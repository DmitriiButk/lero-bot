# Telegram-бот для интернет-магазина "Lero-Bot"

Этот проект представляет собой многофункционального Telegram-бота для интернет-магазина. Он предоставляет удобный
интерфейс для пользователей и мощную панель управления для администраторов.

## Основные возможности

### Для пользователей:

- **Каталог товаров**: Просмотр товаров, сгруппированных по категориям.
- **Карточка товара**: Детальное описание и цена каждого товара.
- **Корзина**: Добавление товаров в корзину, изменение количества или удаление.
- **Оформление заказа**: Простой пошаговый процесс для оформления заказа с указанием контактных данных.

### Для администраторов:

- **Админ-панель**: Отдельное меню с расширенными возможностями, доступное по кнопке `/admin`.
- **Управление категориями**: Добавление и удаление категорий товаров. Реализована защита от удаления непустых
  категорий.
- **Управление товарами**: Добавление новых товаров с указанием названия, описания, цены и категории.
- **Управление заказами**: Просмотр списка всех заказов, их деталей (состав, данные клиента) и изменение статуса (
  например, "Принят", "В обработке", "Выполнен").

## Стек технологий

- **Язык программирования**: Python 3.11+
- **Фреймворк для Telegram**: `aiogram 3.x`
- **База данных**: PostgreSQL
- **ORM**: `SQLAlchemy 2.x` (с асинхронным подходом)
- **Миграции**: `Alembic` для управления схемой базы данных.
- **Контейнеризация**: `Docker` и `Docker Compose` для простого развертывания.
- **Конфигурация**: `pydantic-settings` для управления настройками через переменные окружения.

## Установка и запуск

Проект полностью контейнеризован, что делает его запуск очень простым.

### 1. Предварительные требования

- Установленный [Docker](https://www.docker.com/get-started/)
- Установленный [Docker Compose](https://docs.docker.com/compose/install/)

### 2. Конфигурация

Скопируйте файл `.env.example` и переименуйте его в `.env`:

```bash
cp .env.example .env
```

Откройте файл `.env` и заполните его своими данными:

- `BOT_TOKEN`: Токен вашего Telegram-бота.
- `ADMIN_IDS`: ID вашего Telegram-аккаунта для доступа к админ-панели (можно указать несколько через запятую).
- `DB_USER`, `DB_PASS`, `DB_NAME`: Данные для подключения к базе данных PostgreSQL (можно оставить значения по
  умолчанию).
- `DB_HOST`: Для Docker используйте имя сервиса из `docker-compose.yml`, то есть `db`.
- `DB_PORT`: Стандартный порт PostgreSQL `5432`.

### 3. Запуск

Откройте терминал в корневой папке проекта и выполните команду:

```bash
docker-compose up -d --build
```

- Флаг `--build` необходим при первом запуске или после внесения изменений в код проекта или `Dockerfile`.

Эта команда автоматически соберет образ приложения, запустит контейнеры с ботом и базой данных, применит миграции и
запустит бота.

## Работа с миграциями (Alembic)

Если вы изменили модели в `database/models.py`, вам нужно создать новый файл миграции.

1. **Создание новой миграции** (выполняется на локальной машине, не в Docker):
   ```bash
   alembic revision --autogenerate -m "Краткое описание изменений"
   ```

2. **Применение миграций**:
   Миграции применяются автоматически при каждом запуске `docker-compose up`. Если вам нужно применить их вручную, можно
   выполнить команду внутри запущенного контейнера:
   ```bash
   docker-compose exec bot alembic upgrade head
   ```
